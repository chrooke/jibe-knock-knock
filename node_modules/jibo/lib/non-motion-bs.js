"use strict";var t=function(t){return t&&t.__esModule?t["default"]:t},e=function(){function t(t,e){for(var a in e){var s=e[a];s.configurable=!0,s.value&&(s.writable=!0)}Object.defineProperties(t,e)}return function(e,a,s){return a&&t(e.prototype,a),s&&t(e,s),e}}(),a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=t(require("async")),o=function(){function t(){a(this,t),this.bs={},this.bs.miscState={ts:[],main_board_temp:0,cpu_temp:0,intake_temp:0,exhaust_temp:0,neck_motor_temp:0,torso_motor_temp:0,pelvis_motor_temp:0},this.bs.touchState={ts:[],touched:!1,pad_state:[0,0,0,0,0,0],changed:[0,0,0,0,0,0]},this.bs.powerState={ts:[],source:"",vsys:0,battery:{id:0,cycles:0,capacity:0,max_capacity:0,charge_rate:0,temp:0}}}return e(t,{init:{value:function(t,e){this.httpInterface="http://"+t.host+":"+t.port,this.socketUrl="ws:"+t.host+":"+t.port,s.parallel([this.createMiscSocket.bind(this),this.createTouchSocket.bind(this),this.createPowerSocket.bind(this)],e)}},getBatteryTemperature:{value:function(){return this.bs.powerState.battery.temp}},getBatteryLevel:{value:function(){return this.bs.powerState.battery.capacity/this.bs.powerState.battery.max_capacity*100}},getSystemVoltage:{value:function(){return this.bs.powerState.vsys}},isBatteryCharging:{value:function(){return"EXTERNAL"===this.bs.powerState.source}},getMainBoardTemperature:{value:function(){return this.bs.miscState.main_board_temp}},getCPUTemperature:{value:function(){return this.bs.miscState.cpu_temp}},getTouchState:{value:function(){return this.bs.touchState}},getFanSpeed:{value:function(t){this._getSystemSetting("fan_speed",t)}},getBacklight:{value:function(t){this._getSystemSetting("lcd_backlight",t)}},_getSystemSetting:{value:function(t,e){if(void 0===this.httpInterface)return void e("Body Service is not available",null);var a=new XMLHttpRequest;a.open("GET",this.httpInterface+"/settings",!0),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status)if(a.response){var s=JSON.parse(a.response);e(null,s[t])}else e("No data received from body service",null);else 4==a.readyState&&404==a.status&&e("Body service is unavailable",null)},a.send()}},setBacklight:{value:function(t,e){var a=this;if(0>t||t>1){var s="Backlight brightness value of "+t+" is out of range [0.0 - 1.0].";return void e(s)}this.getFanSpeed(function(s,o){s?e(s):!function(){var s={lcd_backlight:t,fan_speed:o},n=new XMLHttpRequest,r=a.httpInterface+"/settings";n.open("POST",r,!0),n.onreadystatechange=function(){4==n.readyState&&(204==n.status?e(null):404==n.status?e("Body service is unavailable"):400===n.status&&e("Bad request sent to "+r))},n.send(JSON.stringify(s))}()})}},createMiscSocket:{value:function(t){var e=this;this.MiscSocket=new WebSocket(this.socketUrl+"/misc"),this.MiscSocket.onerror=function(){console.error("Error opening misc state socket at "+e.socketUrl+"/misc")},this.MiscSocket.onmessage=function(t){e.bs.miscState=JSON.parse(t.data)},t()}},createTouchSocket:{value:function(t){var e=this;this.TouchSocket=new WebSocket(this.socketUrl+"/touch"),this.TouchSocket.onerror=function(){console.error("Error opening touch state socket at "+e.socketUrl+"/touch")},this.TouchSocket.onmessage=function(t){e.bs.touchState=JSON.parse(t.data);var a=[3,5,4,0,2,1],s=[].concat(e.bs.touchState.pad_state);s.forEach(function(t,o){e.bs.touchState.pad_state[o]=s[a[o]]}),e.bs.touchState.changed.forEach(function(t){e.bs.touchState.changed[t]=a[e.bs.touchState.changed[t]]})},t()}},createPowerSocket:{value:function(t){var e=this;this.PowerSocket=new WebSocket(this.socketUrl+"/power"),this.PowerSocket.onerror=function(){console.error("Error opening power state socket at "+e.socketUrl+"/power")},this.PowerSocket.onmessage=function(t){e.bs.powerState=JSON.parse(t.data)},t()}}}),t}();module.exports=new o;