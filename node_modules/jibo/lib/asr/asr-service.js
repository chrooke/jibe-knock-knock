"use strict";var e=function(e){return e&&e.__esModule?e["default"]:e},t=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=e(require("./asr-vars")),s=e(require("./audio-action")),i=e(require("./speaker-action")),a=e(require("./audio-source")),o=e(require("./recognizer")),c=e(require("./speaker-recognizer")),l=e(require("./end-of-speech-recognizer")),u=e(require("./cloud-recognizer")),h=e(require("./listener")),p=function(){function e(){r(this,e),this.isInitialized=!1,this.msgs=[],this.listSpeakerCallbacks=[],this.deleteSpeakerCallbacks=[]}return t(e,{Recognizer:{get:function(){return o}},EndOfSpeechRecognizer:{get:function(){return l}},CloudRecognizer:{get:function(){return u}},SpeakerRecognizer:{get:function(){return c}},init:{value:function(e,t){var r=this;try{this.socketUrl="ws:"+e.host+":"+e.port+"/port",this.audioUrl="http://"+e.host+":"+e.port+"/audio_source",this.asrInterfaceUrl="http://"+e.host+":"+e.port+"/asr_interface",this.speakerInterfaceUrl="http://"+e.host+":"+e.port+"/spkr_id_interface",this.socket=new WebSocket(this.socketUrl),this.loggingEnabled=!1,this.socket.onerror=function(){console.warn("error connecting to server")},this.socket.onmessage=function(e){var t=JSON.parse(e.data);for(r.msgs.push(t);!r.paused&&r.msgs.length;)r.processNextMessage()},this.alsaSource=new a(this.audioUrl),this.alsaSource.init(function(e){e&&console.warn(e),r.isInitialized=!0,t()})}catch(n){console.warn(n)}}},pause:{value:function(){this.paused=!0}},resume:{value:function(){for(this.paused=!1;this.msgs.length;)this.processNextMessage()}},processNextMessage:{value:function(){this.processMessage(this.msgs.shift())}},processMessage:{value:function(e){this.loggingEnabled&&(console.log("----------------------"),console.log(e));var t=n.idToAction[e.task_id],r=n.idToRecognizer[e.simple_recog_name];return"normal"!==e.status?void("error"===e.status&&t?(console.warn("ASR Service returned error response. Check ASR debug"),t.emit("error",e.message)):"received"===e.status||"other"===e.status?(r&&r.onResult(e),this.loggingEnabled&&console.log("received ASR message")):"LISTING-SPEAKERS"===e.speaker_idstatus?this.listSpeakerCallback(e):"DELETING-SPEAKER"===e.speaker_idstatus&&this.deleteSpeakerCallback(e)):"Speaker ID TD"===e.simple_recog_name?void t.emit("speakerid",e):"pcmwriter"!==e.simple_recog_name?e.final_simple?r?void r.onResult(e):void console.warn("Could not find recognizer with name "+e.simple_recog_name):e.final_composite?(t||console.warn("Could not find action with name "+e.task_id),t.emit("finished"),void t.clear()):void(e.utterances&&e.utterances.length>0&&r&&r.onIncremental&&r.onIncremental(e)):void 0}},createWavSource:{value:function(e){return this.wavSource=new a(this.audioUrl,e),this.wavSource}},createWavAction:{value:function(){var e=new s(this.asrInterfaceUrl);return this.wavSource.link(e),e}},createAudioAction:{value:function(){var e=new s(this.asrInterfaceUrl);return this.alsaSource.link(e),e}},createSpeakerAction:{value:function(){var e=new i(this.speakerInterfaceUrl);return this.alsaSource.link(e),e}},createSpeakerActionAsync:{value:function(e){var t=new i(this.speakerInterfaceUrl);return this.alsaSource.link(t),e(t)}},listEnrolledSpeakers:{value:function(e){this.listSpeakerCallbacks.push(e),this.createSpeakerActionAsync(function(e){e.listSpeakers()})}},listSpeakerCallback:{value:function(e){this.listSpeakerCallbacks.forEach(function(t){t(e)}),this.listSpeakerCallbacks=[]}},deleteSpeaker:{value:function(e,t,r){var n=void 0===arguments[1]?"TD+TI":arguments[1];this.deleteSpeakerCallbacks.push(r),this.createSpeakerActionAsync(function(t){t.deleteSpeaker(e,n)})}},deleteSpeakerCallback:{value:function(e){this.deleteSpeakerCallbacks.forEach(function(t){t(e)}),this.deleteSpeakerCallbacks=[]}},setLogging:{value:function(e){this.loggingEnabled=e}},createListener:{value:function(e,t){return new h(e,t)}}}),e}(),f=new p;module.exports=f;